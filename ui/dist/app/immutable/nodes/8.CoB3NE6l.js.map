{"version":3,"file":"8.CoB3NE6l.js","sources":["../../../../../../src/routes/login/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { isAuthenticated, error } from '$lib/stores';\n\timport pb from '$lib/pocketbase';\n\timport { onMount } from 'svelte';\n\timport { saveAuthToken } from '$lib/auth';\n\timport { page } from '$app/stores';\n\t// Use the public URL instead of importing the asset\n\tconst glimmerLogoUrl = '/glimmer.svg';\n\n\tinterface LoginForm {\n\t\temail: string;\n\t\tpassword: string;\n\t\trememberMe: boolean;\n\t}\n\n\tlet form: LoginForm = {\n\t\temail: '',\n\t\tpassword: '',\n\t\trememberMe: false\n\t};\n\n\tlet isSubmitting = false;\n\tlet formErrors: Partial<Record<keyof LoginForm, string>> = {};\n\tlet returnUrl: string | null = null;\n\n\tfunction validateForm(): boolean {\n\t\tformErrors = {};\n\t\tlet isValid = true;\n\n\t\tif (!form.email) {\n\t\t\tformErrors.email = 'Email is required';\n\t\t\tisValid = false;\n\t\t} else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(form.email)) {\n\t\t\tformErrors.email = 'Please enter a valid email address';\n\t\t\tisValid = false;\n\t\t}\n\n\t\tif (!form.password) {\n\t\t\tformErrors.password = 'Password is required';\n\t\t\tisValid = false;\n\t\t} else if (form.password.length < 6) {\n\t\t\tformErrors.password = 'Password must be at least 6 characters';\n\t\t\tisValid = false;\n\t\t}\n\n\t\treturn isValid;\n\t}\n\n\tasync function handleSubmit() {\n\t\tif (!validateForm()) return;\n\n\t\tisSubmitting = true;\n\t\terror.set(null);\n\n\t\ttry {\n\t\t\tawait pb.collection('users').authWithPassword(form.email, form.password);\n\t\t\t// Use the centralized auth utility to save the token if rememberMe is checked\n\t\t\tsaveAuthToken(form.rememberMe);\n\t\t\tisAuthenticated.set(true);\n\t\t\t\n\t\t\t// Redirect to returnUrl if it exists, otherwise to dashboard\n\t\t\tconst redirectPath = returnUrl ? decodeURIComponent(returnUrl) : '/dashboard';\n\t\t\twindow.location.href = redirectPath;\n\t\t} catch (err) {\n\t\t\tconst errorMessage = err instanceof Error ? err.message : 'Login failed. Please check your credentials.';\n\t\t\terror.set(errorMessage);\n\t\t\tformErrors.email = errorMessage;\n\t\t} finally {\n\t\t\tisSubmitting = false;\n\t\t}\n\t}\n\n\tonMount(() => {\n\t\t// Get returnUrl from query parameters\n\t\treturnUrl = $page.url.searchParams.get('returnUrl');\n\t\t// Clear any existing errors when component mounts\n\t\terror.set(null);\n\t});\n</script>\n\n<div class=\"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900\">\n\t<div class=\"max-w-sm w-full space-y-6 p-6 bg-white dark:bg-gray-800 rounded-xl shadow-md\">\n\t\t<div class=\"text-center\">\n\t\t\t<div class=\"flex items-center justify-center\">\n\t\t\t\t<img src={glimmerLogoUrl} alt=\"Glimmer Logo\" class=\"h-10 w-10 mr-3\" />\n\t\t\t\t<h1 class=\"text-2xl font-bold text-primary dark:text-white\">Glimmer</h1>\n\t\t\t</div>\n\t\t\t<p class=\"mt-1 text-gray-600 dark:text-gray-300 text-base\">Learning Helper for Kids</p>\n\t\t</div>\n\t\t<form on:submit|preventDefault={handleSubmit} class=\"space-y-4\">\n\t\t\t{#if $error}\n\t\t\t\t<div class=\"bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 px-3 py-2 rounded relative text-sm\" role=\"alert\">\n\t\t\t\t\t<strong class=\"font-bold\">Error!</strong>\n\t\t\t\t\t<span class=\"block sm:inline\">{$error}</span>\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t\t<div class=\"space-y-2\">\n\t\t\t\t<div>\n\t\t\t\t\t<label for=\"email\" class=\"sr-only\">Email address</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"email\"\n\t\t\t\t\t\tname=\"email\"\n\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\tautocomplete=\"email\"\n\t\t\t\t\t\trequired\n\t\t\t\t\t\tbind:value={form.email}\n\t\t\t\t\t\tclass=\"block w-full px-3 py-2 rounded-t-md border {formErrors.email ? 'border-red-500 dark:border-red-400' : 'border-gray-300 dark:border-gray-600'} placeholder-gray-400 dark:placeholder-gray-500 text-gray-900 dark:text-gray-100 bg-gray-100 dark:bg-gray-700 focus:outline-none focus:ring-secondary focus:border-secondary sm:text-sm\"\n\t\t\t\t\t\tplaceholder=\"Email address\"\n\t\t\t\t\t\tdisabled={isSubmitting}\n\t\t\t\t\t\taria-invalid={!!formErrors.email}\n\t\t\t\t\t\taria-describedby={formErrors.email ? 'email-error' : undefined}\n\t\t\t\t\t/>\n\t\t\t\t\t{#if formErrors.email}\n\t\t\t\t\t\t<p id=\"email-error\" class=\"mt-1 text-xs text-red-600 dark:text-red-300\">{formErrors.email}</p>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t\t<div>\n\t\t\t\t\t<label for=\"password\" class=\"sr-only\">Password</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"password\"\n\t\t\t\t\t\tname=\"password\"\n\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\tautocomplete=\"current-password\"\n\t\t\t\t\t\trequired\n\t\t\t\t\t\tbind:value={form.password}\n\t\t\t\t\t\tclass=\"block w-full px-3 py-2 rounded-b-md border {formErrors.password ? 'border-red-500 dark:border-red-400' : 'border-gray-300 dark:border-gray-600'} placeholder-gray-400 dark:placeholder-gray-500 text-gray-900 dark:text-gray-100 bg-gray-100 dark:bg-gray-700 focus:outline-none focus:ring-secondary focus:border-secondary sm:text-sm\"\n\t\t\t\t\t\tplaceholder=\"Password\"\n\t\t\t\t\t\tdisabled={isSubmitting}\n\t\t\t\t\t\taria-invalid={!!formErrors.password}\n\t\t\t\t\t\taria-describedby={formErrors.password ? 'password-error' : undefined}\n\t\t\t\t\t/>\n\t\t\t\t\t{#if formErrors.password}\n\t\t\t\t\t\t<p id=\"password-error\" class=\"mt-1 text-xs text-red-600 dark:text-red-300\">{formErrors.password}</p>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"flex items-center justify-between\">\n\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tid=\"remember-me\"\n\t\t\t\t\t\tname=\"remember-me\"\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\tbind:checked={form.rememberMe}\n\t\t\t\t\t\tclass=\"h-4 w-4 text-secondary focus:ring-secondary border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700\"\n\t\t\t\t\t\tdisabled={isSubmitting}\n\t\t\t\t\t/>\n\t\t\t\t\t<label for=\"remember-me\" class=\"ml-2 block text-xs text-gray-900 dark:text-gray-200\">\n\t\t\t\t\t\tRemember me\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"text-xs\">\n\t\t\t\t\t<a href=\"/forgot-password\" class=\"font-medium text-secondary hover:text-secondary focus:outline-none focus:underline dark:text-blue-400\">\n\t\t\t\t\t\tForgot your password?\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<button\n\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\tdisabled={isSubmitting}\n\t\t\t\t\tclass=\"w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-secondary hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-secondary disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200\"\n\t\t\t\t>\n\t\t\t\t\t{#if isSubmitting}\n\t\t\t\t\t\t<svg class=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n\t\t\t\t\t\t\t<path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\tSigning in...\n\t\t\t\t\t{:else}\n\t\t\t\t\t\tSign in\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n</div>\n\n<style lang=\"postcss\">\n\t:global(html) {\n\t\t--primary: #2c3e50;\n\t\t--secondary: #3498db;\n\t}\n\n\t.text-primary {\n\t\tcolor: var(--primary);\n\t}\n\n\t.bg-secondary {\n\t\tbackground-color: var(--secondary);\n\t}\n\n\t.focus\\:ring-secondary:focus {\n\t\t--tw-ring-color: var(--secondary);\n\t}\n\n\t.focus\\:border-secondary:focus {\n\t\tborder-color: var(--secondary);\n\t}\n</style> "],"names":["glimmerLogoUrl","form","$.mutable_source","isSubmitting","formErrors","returnUrl","validateForm","isValid","$.mutate","$.get","handleSubmit","$.set","error","pb","saveAuthToken","isAuthenticated","redirectPath","err","errorMessage","onMount","$page","$error","$$render","consequent","$.template_effect","$.set_text","text_1","consequent_1","text_2","consequent_2","consequent_3","alternate","$.set_class","input","$.set_attribute","input_1","$.bind_value","$$value","$.bind_checked","input_2"],"mappings":"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"}