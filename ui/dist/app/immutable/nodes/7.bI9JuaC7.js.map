{"version":3,"file":"7.bI9JuaC7.js","sources":["../../../../../../src/components/learners/LearnerForm.svelte","../../../../../../src/routes/learners/edit/[id]/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { createEventDispatcher } from 'svelte';\n\timport pb from '$lib/pocketbase';\n\timport type { Learner } from '$lib/types';\n\timport FormField from '../common/FormField.svelte';\n\timport FormButton from '../common/FormButton.svelte';\n\timport FormSection from '../common/FormSection.svelte';\n\timport ErrorAlert from '../common/ErrorAlert.svelte';\n\timport TextArea from '../common/TextArea.svelte';\n\n\texport let learner: Learner | null = null;\n\n\tconst dispatch = createEventDispatcher<{\n\t\tupdate: Learner;\n\t\tdelete: string;\n\t\tcancel: void;\n\t}>();\n\n\ttype FormData = {\n\t\tnickname: string;\n\t\tage: number;\n\t\tgrade_level: string;\n\t\tlearning_preferences: string[];\n\t\tavatar: string;\n\t};\n\n\tlet formData: FormData = learner ? {\n\t\tnickname: learner.nickname,\n\t\tage: learner.age,\n\t\tgrade_level: learner.grade_level || '',\n\t\tlearning_preferences: Array.isArray(learner.learning_preferences) ? learner.learning_preferences : [],\n\t\tavatar: learner.avatar || ''\n\t} : {\n\t\tnickname: '',\n\t\tage: 0,\n\t\tgrade_level: '',\n\t\tlearning_preferences: [],\n\t\tavatar: ''\n\t};\n\n\tlet loading = false;\n\tlet error: string | null = null;\n\tlet learningPreferencesText = formData.learning_preferences.join('\\n');\n\n\t$: {\n\t\tformData.learning_preferences = learningPreferencesText.split('\\n').map(pref => pref.trim()).filter(Boolean);\n\t}\n\n\t// Validate form data\n\tfunction validateForm() {\n\t\tif (!formData.nickname.trim()) return \"Nickname is required\";\n\t\tif (formData.age < 0 || formData.age > 120) return \"Age must be between 0 and 120\";\n\t\treturn null;\n\t}\n\n\tasync function handleSubmit() {\n\t\tconst validationError = validateForm();\n\t\tif (validationError) {\n\t\t\terror = validationError;\n\t\t\treturn;\n\t\t}\n\t\n\t\ttry {\n\t\t\tloading = true;\n\t\t\terror = null;\n\n\t\t\t// Get the current user\n\t\t\tconst currentUser = pb.authStore.model;\n\t\t\tif (!currentUser && !learner) {\n\t\t\t\terror = 'You must be logged in to create a learner';\n\t\t\t\tloading = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Prepare data to send\n\t\t\tconst dataToSend = { ...formData };\n\t\t\t\n\t\t\t// Make sure learning preferences are properly formatted as an array\n\t\t\tif (typeof dataToSend.learning_preferences === 'string') {\n\t\t\t\tdataToSend.learning_preferences = (dataToSend.learning_preferences as string).split('\\n').map(pref => pref.trim()).filter(Boolean);\n\t\t\t}\n\t\t\t\n\t\t\tconsole.log('Data being sent to server:', dataToSend);\n\t\t\t\n\t\t\tlet result;\n\t\t\tif (learner) {\n\t\t\t\t// Update existing learner\n\t\t\t\tresult = await pb.collection('learners').update(learner.id, dataToSend);\n\t\t\t} else {\n\t\t\t\t// Create new learner\n\t\t\t\tresult = await pb.collection('learners').create(dataToSend);\n\t\t\t}\n\t\t\t\n\t\t\t// Dispatch the update event with the result\n\t\t\tdispatch('update', result as unknown as Learner);\n\t\t} catch (err) {\n\t\t\tconsole.error('Failed to save learner:', err);\n\t\t\terror = 'Failed to save learner';\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n\n\tasync function handleDelete() {\n\t\tif (!learner) return;\n\n\t\tif (!confirm('Are you sure you want to delete this learner?')) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tloading = true;\n\t\t\terror = null;\n\t\t\tawait pb.collection('learners').delete(learner.id);\n\t\t\tdispatch('delete', learner.id);\n\t\t} catch (err) {\n\t\t\tconsole.error('Failed to delete learner:', err);\n\t\t\terror = 'Failed to delete learner';\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n</script>\n\n<FormSection title={learner ? \"Edit Learner\" : \"Create Learner\"} description=\"Enter the details for this learner\">\n\t<form on:submit|preventDefault={handleSubmit} class=\"w-full\">\n\t\t{#if error}\n\t\t\t<div class=\"px-4 mb-6\">\n\t\t\t\t<ErrorAlert message={error} />\n\t\t\t</div>\n\t\t{/if}\n\n\t\t<div class=\"px-4 py-4 bg-white w-full\">\n\t\t\t<div class=\"grid grid-cols-6 gap-6\">\n\t\t\t\t<FormField\n\t\t\t\t\tlabel=\"Nickname\"\n\t\t\t\t\tid=\"nickname\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tbind:value={formData.nickname}\n\t\t\t\t\trequired\n\t\t\t\t\tcols=\"col-span-6\"\n\t\t\t\t\tplaceholder=\"Enter learner's nickname\"\n\t\t\t\t/>\n\n\t\t\t\t<FormField\n\t\t\t\t\tlabel=\"Age\"\n\t\t\t\t\tid=\"age\"\n\t\t\t\t\ttype=\"number\"\n\t\t\t\t\tvalue={formData.age.toString()}\n\t\t\t\t\ton:input={(e) => {\n\t\t\t\t\t\tconst target = e.target as HTMLInputElement;\n\t\t\t\t\t\tformData.age = parseInt(target.value) || 0;\n\t\t\t\t\t}}\n\t\t\t\t\trequired\n\t\t\t\t\tcols=\"col-span-6 sm:col-span-3\"\n\t\t\t\t\tplaceholder=\"Enter age\"\n\t\t\t\t/>\n\n\t\t\t\t<FormField\n\t\t\t\t\tlabel=\"Grade Level\"\n\t\t\t\t\tid=\"gradeLevel\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tbind:value={formData.grade_level}\n\t\t\t\t\tcols=\"col-span-6 sm:col-span-3\"\n\t\t\t\t\tplaceholder=\"e.g. 3rd Grade\"\n\t\t\t\t/>\n\n\t\t\t\t<TextArea\n\t\t\t\t\tid=\"learning_preferences\"\n\t\t\t\t\tlabel=\"Learning Preferences\"\n\t\t\t\t\tbind:value={learningPreferencesText}\n\t\t\t\t\tcols=\"col-span-6\"\n\t\t\t\t\tplaceholder=\"Enter learning preferences, one per line\"\n\t\t\t\t/>\n\n\t\t\t\t<FormField\n\t\t\t\t\tlabel=\"Avatar URL\"\n\t\t\t\t\tid=\"avatar\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\tbind:value={formData.avatar}\n\t\t\t\t\tcols=\"col-span-6\"\n\t\t\t\t\tplaceholder=\"Enter avatar image URL\"\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"px-4 py-3 bg-gray-50 border-t border-gray-200 flex justify-end space-x-4\">\n\t\t\t<FormButton\n\t\t\t\ttype=\"button\"\n\t\t\t\tvariant=\"secondary\"\n\t\t\t\ton:click={() => dispatch('cancel')}\n\t\t\t>\n\t\t\t\tCancel\n\t\t\t</FormButton>\n\t\t\t{#if learner}\n\t\t\t\t<FormButton\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tvariant=\"danger\"\n\t\t\t\t\ton:click={handleDelete}\n\t\t\t\t\tdisabled={loading}\n\t\t\t\t>\n\t\t\t\t\tDelete\n\t\t\t\t</FormButton>\n\t\t\t{/if}\n\t\t\t<FormButton\n\t\t\t\ttype=\"submit\"\n\t\t\t\tisLoading={loading}\n\t\t\t\tloadingText=\"Saving...\"\n\t\t\t>\n\t\t\t\tSave\n\t\t\t</FormButton>\n\t\t</div>\n\t</form>\n</FormSection> ","<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { page } from '$app/stores';\n\timport { goto } from '$app/navigation';\n\timport type { Learner } from '$lib/types';\n\timport pb from '$lib/pocketbase';\n\timport LearnerForm from '../../../../components/learners/LearnerForm.svelte';\n\timport FormButton from '../../../../components/common/FormButton.svelte';\n\n\tlet learner: Learner | null = null;\n\tlet loading = true;\n\tlet error: string | null = null;\n\n\tonMount(async () => {\n\t\t// Get learner ID from the URL parameter\n\t\tconst learnerId = $page.params.id;\n\t\t\n\t\tif (!learnerId) {\n\t\t\terror = 'No learner ID provided';\n\t\t\tloading = false;\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tawait loadLearner(learnerId);\n\t});\n\n\tasync function loadLearner(id: string) {\n\t\ttry {\n\t\t\tloading = true;\n\t\t\terror = null;\n\t\t\t\n\t\t\tconst result = await pb.collection('learners').getOne<Learner>(id, {\n\t\t\t\texpand: 'user'\n\t\t\t});\n\t\t\t\n\t\t\t// Map expanded user data to the learner object\n\t\t\tconst expandedData = result.expand;\n\t\t\tlearner = {\n\t\t\t\t...result,\n\t\t\t\tuser: expandedData?.user || { name: 'Unknown user' }\n\t\t\t} as unknown as Learner;\n\t\t} catch (err) {\n\t\t\tconsole.error('Failed to load learner:', err);\n\t\t\terror = 'Failed to load learner';\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n\n\tfunction handleLearnerUpdate(updatedLearner: Learner) {\n\t\tgoto('/learners');\n\t}\n\n\tfunction handleLearnerDelete(learnerId: string) {\n\t\tgoto('/learners');\n\t}\n\n\tfunction handleCancel() {\n\t\tgoto('/learners');\n\t}\n</script>\n\n<div class=\"container mx-auto px-4 py-8 max-w-7xl\">\n\t<div class=\"flex justify-between items-center mb-6\">\n\t\t<h1 class=\"text-2xl font-bold text-gray-900\">\n\t\t\t{learner ? 'Edit Learner' : 'Loading...'}\n\t\t</h1>\n\t\t<FormButton\n\t\t\ttype=\"button\"\n\t\t\tvariant=\"secondary\"\n\t\t\ton:click={handleCancel}\n\t\t>\n\t\t\tBack to Learners\n\t\t</FormButton>\n\t</div>\n\n\t{#if loading}\n\t\t<div class=\"flex justify-center items-center h-64\">\n\t\t\t<div class=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary\"></div>\n\t\t</div>\n\t{:else if error}\n\t\t<div class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative\" role=\"alert\">\n\t\t\t<strong class=\"font-bold\">Error!</strong>\n\t\t\t<span class=\"block sm:inline\"> {error}</span>\n\t\t</div>\n\t{:else if learner}\n\t\t<div class=\"w-full\">\n\t\t\t<LearnerForm\n\t\t\t\t{learner}\n\t\t\t\ton:update={({ detail }) => handleLearnerUpdate(detail)}\n\t\t\t\ton:delete={({ detail }) => handleLearnerDelete(detail)}\n\t\t\t\ton:cancel={handleCancel}\n\t\t\t/>\n\t\t</div>\n\t{/if}\n</div> "],"names":["learner","dispatch","createEventDispatcher","formData","loading","error","learningPreferencesText","validateForm","$.get","handleSubmit","validationError","$.set","pb","dataToSend","pref","result","err","handleDelete","$$render","consequent","$$value","e","target","consequent_1","onMount","learnerId","$page","loadLearner","id","expandedData","handleLearnerUpdate","updatedLearner","goto","handleLearnerDelete","handleCancel","detail","consequent_2","alternate_1","alternate"],"mappings":"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"}