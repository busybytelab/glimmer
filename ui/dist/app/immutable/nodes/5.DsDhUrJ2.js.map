{"version":3,"file":"5.DsDhUrJ2.js","sources":["../../../../../../src/routes/learners/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport pb from '$lib/pocketbase';\n\timport { goto } from '$app/navigation';\n\timport type { Learner } from '$lib/types';\n\timport LearnersList from '../../components/learners/LearnersList.svelte';\n\timport FormButton from '../../components/common/FormButton.svelte';\n\n\tlet learners: Learner[] = [];\n\tlet loading = true;\n\tlet error: string | null = null;\n\n\tasync function loadLearners() {\n\t\ttry {\n\t\t\tloading = true;\n\t\t\terror = null;\n\n\t\t\t// Check if user is authenticated\n\t\t\tconst authData = pb.authStore.model;\n\t\t\tif (!authData) {\n\t\t\t\terror = 'You must be logged in to view learners';\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Get instructor record to get the account\n\t\t\tconst instructorRecord = await pb.collection('instructors').getFirstListItem(`user=\"${authData.id}\"`);\n\t\t\t\n\t\t\t// Get learners from the same account\n\t\t\tconst result = await pb.collection('learners').getFullList({\n\t\t\t\tfilter: `account=\"${instructorRecord.account}\"`,\n\t\t\t\tsort: '-created',\n\t\t\t\texpand: 'user,account'\n\t\t\t});\n\t\t\t\n\t\t\t// Map expanded data to the learner objects\n\t\t\tlearners = result.map(item => {\n\t\t\t\tconsole.log('learner Item:', item);\n\t\t\t\tconst expandedData = item.expand;\n\t\t\t\treturn {\n\t\t\t\t\t...item,\n\t\t\t\t\tuser: expandedData?.user || { name: 'Unknown user' },\n\t\t\t\t\taccount: expandedData?.account || null\n\t\t\t\t};\n\t\t\t}) as unknown as Learner[];\n\t\t\t\n\t\t\tconsole.log('Loaded learners:', learners);\n\t\t} catch (err) {\n\t\t\tconsole.error('Failed to load learners:', err);\n\t\t\terror = 'Failed to load learners';\n\t\t} finally {\n\t\t\tloading = false;\n\t\t}\n\t}\n\n\tonMount(async () => {\n\t\tconsole.log('Learners mounted, loading learners');\n\t\tawait loadLearners();\n\t});\n\n\tfunction handleCreateNew() {\n\t\tgoto('/learners/create');\n\t}\n\n\tfunction viewLearner(learner: Learner) {\n\t\tgoto(`/learners/${learner.id}`);\n\t}\n</script>\n\n<div class=\"container mx-auto px-4 py-8\">\n\t<div class=\"flex justify-between items-center mb-6\">\n\t\t<h1 class=\"text-2xl font-bold text-gray-900\">Learners</h1>\n\t\t<FormButton\n\t\t\ttype=\"button\"\n\t\t\ton:click={handleCreateNew}\n\t\t>\n\t\t\tCreate New Learner\n\t\t</FormButton>\n\t</div>\n\n\t{#if loading}\n\t\t<div class=\"flex justify-center items-center h-64\">\n\t\t\t<div class=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary\"></div>\n\t\t</div>\n\t{:else if error}\n\t\t<div class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative\" role=\"alert\">\n\t\t\t<strong class=\"font-bold\">Error!</strong>\n\t\t\t<span class=\"block sm:inline\"> {error}</span>\n\t\t</div>\n\t{:else}\n\t<LearnersList\n\t{learners}\n\t{loading}\n\temptyMessage=\"No learners found. Create your first learner!\"\n\tonClick={viewLearner}\n\tcardActions={[]}\n/>\n\t{/if}\n</div> "],"names":["learners","$.mutable_source","loading","error","loadLearners","$.set","authData","pb","instructorRecord","result","item","expandedData","err","onMount","handleCreateNew","goto","viewLearner","learner","$$render","consequent_1","alternate_1","consequent","alternate"],"mappings":"ikCAQKA,EAAmBC,EAAA,EAAA,EACnBC,IAAU,EAAI,EACdC,IAAuB,IAAI,EAEhB,eAAAC,GAAe,CACzB,GAAA,CACHC,EAAAH,EAAU,EAAI,EACdG,EAAAF,EAAQ,IAAI,EAGN,MAAAG,EAAWC,EAAG,UAAU,MACzB,GAAA,CAAAD,EAAU,CACdD,EAAAF,EAAQ,wCAAwC,QAEjD,OAGMK,EAAgB,MAASD,EAAG,WAAW,aAAa,EAAE,iBAAgB,SAAUD,EAAS,EAAE,GAAA,EAG3FG,QAAeF,EAAG,WAAW,UAAU,EAAE,YAAW,CACzD,OAAM,YAAcC,EAAiB,OAAO,IAC5C,KAAM,WACN,OAAQ,iBAITH,EAAAL,EAAWS,EAAO,IAAIC,GAAQ,CAC7B,QAAQ,IAAI,gBAAiBA,CAAI,QAC3BC,EAAeD,EAAK,iBAEtBA,EACH,MAAMC,GAAA,YAAAA,EAAc,OAAU,CAAA,KAAM,cAAc,EAClD,SAASA,GAAA,YAAAA,EAAc,UAAW,MAEnC,CAAA,EAED,QAAQ,IAAI,qBAAoBX,CAAQ,CAAA,CACxC,OAAQY,EAAK,CACb,QAAQ,MAAM,2BAA4BA,CAAG,EAC7CP,EAAAF,EAAQ,yBAAyB,CAClC,QAAU,CACTE,EAAAH,EAAU,EAAK,CAChB,CACD,CAEAW,EAAoB,SAAA,CACnB,QAAQ,IAAI,oCAAoC,QAC1CT,EAAY,EAClB,EAEQ,SAAAU,GAAkB,CAC1BC,EAAK,kBAAkB,CACxB,UAESC,EAAYC,EAAkB,CACtCF,EAAI,aAAcE,EAAQ,EAAE,EAAA,CAC7B,qEAQYH,CAAe,8MAaOX,CAAK,CAAA,CAAA,iJAO9Ba,8BAVCb,CAAK,EAAAe,EAAAC,CAAA,EAAAD,EAAAE,EAAA,EAAA,kBAJVlB,CAAO,EAAAgB,EAAAG,CAAA,EAAAH,EAAAI,EAAA,EAAA"}