import{t as m,a as f}from"../chunks/Budn9l7p.js";import"../chunks/C5lklyGm.js";import{p as ye,l as we,e as ke,a as Se,g as e,m as v,c as n,d as Ae,s as l,b as r,r as c,t as h,f as Ee,n as $e}from"../chunks/Dy_2QLcd.js";import{s as g}from"../chunks/HzhFnYKD.js";import{i as _}from"../chunks/CSRWkSd7.js";import{i as Le}from"../chunks/Bd0QBR9D.js";import{s as Pe,a as Te}from"../chunks/CbMnyNtw.js";import{o as je}from"../chunks/CeJAMhHV.js";import{p as Ce}from"../chunks/DtAyR18x.js";import{g as Z}from"../chunks/BHgSklzR.js";import{p as w}from"../chunks/3tUVfVXT.js";import{L as Ie}from"../chunks/XMx0U6Hf.js";import{B as Be,A as Fe}from"../chunks/Dl4L_VQ5.js";class qe{async ensureAuth(){if(!w.authStore.isValid)throw new Error("You must be logged in to create a practice session")}async refreshAuth(){try{await w.collection("users").authRefresh()}catch{throw w.authStore.clear(),new Error("Your session has expired. Please log in again.")}}async makeRequest(b){const d=await fetch("/api/practice/session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:w.authStore.token},body:JSON.stringify(b)});if(!d.ok){const k=await d.json().catch(()=>({}));throw{status:d.status,message:k.message||`Server error: ${d.status}`}}return d.json()}async createSession(b){await this.ensureAuth();try{return await this.makeRequest(b)}catch(d){if(d.status===401){await this.refreshAuth();try{return await this.makeRequest(b)}catch(k){throw new Error(k.message)}}throw new Error(d.message)}}}const De=new qe;var Oe=m('<div class="flex justify-center items-center h-64"><div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div></div>'),Re=m('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert"><strong class="font-bold">Error!</strong> <span class="block sm:inline"> </span></div>'),ze=m('<p class="text-gray-600 mb-4"> </p>'),Me=m('<span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded"> </span>'),Ne=m('<span class="bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded"> </span>'),Je=m('<span class="bg-orange-100 text-orange-800 text-xs font-medium px-2.5 py-0.5 rounded"> </span>'),Ve=m(`<div class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50"><div class="bg-white rounded-lg p-8 max-w-md w-full mx-4"><div class="flex flex-col items-center"><div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-primary mb-4"></div> <h3 class="text-xl font-semibold text-gray-900 mb-2">Creating Practice Session</h3> <p class="text-gray-600 text-center mb-4"> </p> <p class="text-gray-600 text-center mb-4">This may take a few minutes. Please don't refresh the page.</p> <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-primary h-2.5 rounded-full animate-pulse"></div></div></div></div></div>`),We=m('<div class="bg-white shadow-md rounded-lg p-6 mb-6"><h2 class="text-xl font-semibold text-gray-900 mb-2"> </h2> <!> <div class="flex flex-wrap gap-2 mb-4"><span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded"> </span> <!> <!> <!></div></div> <h2 class="text-xl font-semibold text-gray-900 mb-4">Select a Learner</h2> <!> <!>',1),Ye=m('<div class="container mx-auto px-4 py-8"><div class="flex justify-between items-center mb-6"><div><!></div> <!></div> <!></div>');function ir(R,b){ye(b,!1);const[d,k]=Pe(),ee=()=>Te(Ce,"$page",d),z=v();let i=v(null),M=v([]),S=v(!0),T=v(!0),j=v(!1),C=v(null),u=v(null),L=null,N=v([]);je(async()=>{try{L=ee().params.id,L?(await re(L),await te(),se()):(r(u,"Invalid topic ID"),r(S,!1))}catch(t){console.error("Error in onMount:",t),r(u,t instanceof Error?t.message:"An unexpected error occurred"),r(S,!1)}});async function re(t){try{if(r(S,!0),r(u,null),!t)throw new Error("Topic ID is required");const a=await w.collection("practice_topics").getOne(t);if(a.tags){const x=a.tags;if(typeof x=="string")try{x.trim().startsWith("[")?a.tags=JSON.parse(x):a.tags=x.split(",").map(A=>A.trim()).filter(Boolean)}catch(A){console.error("Error parsing tags:",A),a.tags=[]}}else a.tags=[];r(i,a)}catch(a){console.error("Failed to load topic:",a),r(u,"Failed to load practice topic")}finally{r(S,!1)}}async function te(){try{r(T,!0);const t=await w.collection("learners").getList(1,50,{sort:"nickname",expand:"user"});r(M,t.items)}catch(t){console.error("Failed to load learners:",t),r(u,"Failed to load learners")}finally{r(T,!1)}}function ae(){Z(`/practice-topics/${L}`)}async function J(t){if(e(i))try{r(j,!0),r(u,null),r(C,t);const a=await De.createSession({learnerId:t.id,practiceTopicId:e(i).id});Z(`/practice-sessions/${a.id}`)}catch(a){console.error("Failed to create practice session:",a),r(u,a instanceof Error?a.message:"An unexpected error occurred")}finally{r(j,!1),r(C,null)}}function se(){e(i)&&r(N,[{label:"Topics",href:"/practice-topics",icon:"topic"},{label:e(i).name,href:`/practice-topics/${e(i).id}`,icon:"topic"},{label:"Create Session",icon:"create"}])}we(()=>{},()=>{r(z,{id:"back",label:"Back",icon:"back",variant:"secondary",onClick:ae})}),ke(),Le();var I=Ye(),B=n(I),F=n(B),oe=n(F);Be(oe,{get items(){return e(N)}}),c(F);var ie=l(F,2);const ne=Ae(()=>[e(z)]);Fe(ie,{get actions(){return e(ne)}}),c(B);var ce=l(B,2);{var le=t=>{var a=Oe();f(t,a)},de=(t,a)=>{{var x=y=>{var E=Re(),P=l(n(E),2),$=n(P,!0);c(P),c(E),h(()=>g($,e(u))),f(y,E)},A=(y,E)=>{{var P=$=>{var V=We(),q=Ee(V),D=n(q),pe=n(D,!0);c(D);var W=l(D,2);{var ue=s=>{var o=ze(),p=n(o,!0);c(o),h(()=>g(p,e(i).description)),f(s,o)};_(W,s=>{e(i).description&&s(ue)})}var Y=l(W,2),O=n(Y),fe=n(O,!0);c(O);var G=l(O,2);{var ve=s=>{var o=Me(),p=n(o);c(o),h(()=>g(p,`Age: ${e(i).target_age_range??""}`)),f(s,o)};_(G,s=>{e(i).target_age_range&&s(ve)})}var H=l(G,2);{var me=s=>{var o=Ne(),p=n(o);c(o),h(()=>g(p,`Grade: ${e(i).target_grade_level??""}`)),f(s,o)};_(H,s=>{e(i).target_grade_level&&s(me)})}var ge=l(H,2);{var _e=s=>{var o=Je(),p=n(o);c(o),h(()=>g(p,`Difficulty: ${e(i).difficulty_level??""}`)),f(s,o)};_(ge,s=>{e(i).difficulty_level&&s(_e)})}c(Y),c(q);var K=l(q,4);Ie(K,{get learners(){return e(M)},get loading(){return e(T)},emptyMessage:"No learners found. Please add learners to your account first.",onClick:J,cardActions:[{label:"Create Practice",color:"primary",onClick:J}]});var be=l(K,2);{var he=s=>{var o=Ve(),p=n(o),Q=n(p),U=l(n(Q),4),xe=n(U);c(U),$e(4),c(Q),c(p),c(o),h(()=>{var X;return g(xe,`We're generating personalized practice items for ${((X=e(C))==null?void 0:X.nickname)||"the learner"}.`)}),f(s,o)};_(be,s=>{e(j)&&s(he)})}h(()=>{g(pe,e(i).name),g(fe,e(i).subject)}),f($,V)};_(y,$=>{e(i)&&$(P)},E)}};_(t,y=>{e(u)?y(x):y(A,!1)},a)}};_(ce,t=>{e(S)?t(le):t(de,!1)})}c(I),f(R,I),Se(),k()}export{ir as component};
//# sourceMappingURL=12.D2r2A_f-.js.map
