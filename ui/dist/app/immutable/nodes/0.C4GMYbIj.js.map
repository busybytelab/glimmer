{"version":3,"file":"0.C4GMYbIj.js","sources":["../../../../../../src/routes/+layout.ts","../../../../../../src/components/layout/SideNav.svelte","../../../../../../src/routes/+layout.svelte"],"sourcesContent":["export const prerender = false;\nexport const ssr = false; \n","<script lang=\"ts\">\n    // Use the public URL instead of importing the asset\n    const glimmerLogoUrl = '/glimmer.svg';\n    import { goto } from '$app/navigation';\n    import { page } from '$app/stores';\n    \n    export let isOpen: boolean = true;\n    \n    const navItems = [\n        { href: '/dashboard', label: 'Dashboard', icon: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6' },\n        { href: '/practice-topics', label: 'Practice Topics', icon: 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253' },\n        { href: '/learners', label: 'Learners', icon: 'M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z' },\n        { href: '/chat', label: 'Chat', icon: 'M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z' },\n        { href: '/profile', label: 'Profile', icon: 'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z' },\n        { href: '/settings', label: 'Settings', icon: 'M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z' },\n    ];\n    \n    function isActive(href: string): boolean {\n        if ($page) {\n            const path = $page.url.pathname;\n            if (href === '/dashboard' && path === '/dashboard') {\n                return true;\n            }\n            return path.startsWith(href);\n        }\n        return false;\n    }\n</script>\n\n<aside class={`bg-white border-r border-gray-200 w-64 flex-shrink-0 ${isOpen ? '' : 'hidden'} md:block`}>\n    <div class=\"h-full flex flex-col\">\n        <div class=\"flex items-center justify-center h-16 border-b border-gray-200\">\n            <img src={glimmerLogoUrl} alt=\"Glimmer Logo\" class=\"h-8 w-8 mr-2\" />\n            <div class=\"text-xl font-semibold text-gray-800\">Glimmer</div>\n        </div>\n        \n        <nav class=\"flex-1 overflow-y-auto p-4\">\n            <ul class=\"space-y-2\">\n                {#each navItems as item}\n                    <li>\n                        <a \n                            href={item.href}\n                            class={`flex items-center p-2 rounded-md hover:bg-gray-100 transition-colors ${isActive(item.href) ? 'bg-gray-100 text-indigo-600' : 'text-gray-700'}`}\n                        >\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 mr-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d={item.icon} />\n                            </svg>\n                            <span>{item.label}</span>\n                        </a>\n                    </li>\n                {/each}\n            </ul>\n        </nav>\n        \n        <div class=\"p-4 border-t border-gray-200\">\n            <button \n                class=\"flex items-center justify-center w-full p-2 bg-red-50 text-red-600 rounded-md hover:bg-red-100 transition-colors\"\n                on:click={() => {\n                    // Clear auth token and reload\n                    localStorage.removeItem('pocketbase_auth');\n                    window.location.href = '/';\n                }}\n            >\n                <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-5 w-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\n                </svg>\n                Sign Out\n            </button>\n        </div>\n    </div>\n</aside> ","<script lang=\"ts\">\n  import { onMount } from 'svelte';\n  import { isAuthenticated, user, isAuthLoading, error } from '$lib/stores';\n  import pb from '$lib/pocketbase';\n  import { getAuthToken, clearAuthToken } from '$lib/auth';\n  import type { Instructor, Learner } from '$lib/types';\n  import SideNav from '../components/layout/SideNav.svelte';\n  import '../app.css';\n\n  // List of public routes that don't require authentication\n  const publicRoutes = ['/login', '/forgot-password', '/reset-password'];\n\n  // Sidebar state for layout\n  let sidebarOpen = true;\n\n  // Toggle sidebar\n  function toggleSidebar() {\n    sidebarOpen = !sidebarOpen;\n  }\n\n  // Check if current route is public\n  $: isPublicRoute = publicRoutes.some(route => window.location.pathname.startsWith(route));\n\n  // Function to handle the auth flow\n  async function initializeAuth() {\n    isAuthLoading.set(true);\n    error.set(null);\n    \n    try {\n      // Get token using our utility function\n      const token = getAuthToken();\n      \n      // Only proceed with auth verification if we have a token\n      if (token) {\n        // Set token in PocketBase if it's not already set\n        if (pb.authStore.token !== token) {\n          // Since token is read-only, we need to clear and recreate the auth store\n          pb.authStore.clear();\n          // Then manually save the auth data with the token\n          localStorage.setItem('pocketbase_auth', JSON.stringify({\n            token: token,\n            model: pb.authStore.model\n          }));\n        }\n        \n        try {\n          // Refresh auth state, which validates the token and gets fresh user data\n          await pb.collection('users').authRefresh();\n          \n          // Token is valid, get user data\n          if (pb.authStore.isValid) {\n            const userData = await pb.collection('users').getOne(pb.authStore.record?.id ?? '');\n            \n            // First check if user is an instructor\n            try {\n              const instructor = await pb.collection('instructors').getFirstListItem(`user=\"${pb.authStore.record?.id}\"`);\n              if (instructor) {\n                instructor.user = userData;\n                user.set(instructor as unknown as Instructor);\n                isAuthenticated.set(true);\n                return;\n              }\n            } catch (err) {\n              // No instructor found, continue to check for learner\n            }\n\n            // Then check if user is a learner\n            try {\n              const learner = await pb.collection('learners').getFirstListItem(`user=\"${pb.authStore.record?.id}\"`, { requestKey: null });\n              if (learner) {\n                learner.user = userData;\n                user.set(learner as unknown as Learner);\n                isAuthenticated.set(true);\n                return;\n              }\n            } catch (err) {\n              // No learner found\n            }\n\n            // If we get here, user exists in main users collection but not in instructors/learners\n            // Clear auth state and show login\n            clearAuthToken();\n            isAuthenticated.set(false);\n          }\n        } catch (err) {\n          // Token refresh failed, clear auth state\n          console.error('Auth refresh failed:', err);\n          clearAuthToken();\n          isAuthenticated.set(false);\n        }\n      } else {\n        // No token, user is not authenticated\n        isAuthenticated.set(false);\n      }\n    } catch (err) {\n      // Catch any other errors\n      console.error('Authentication initialization failed:', err);\n      clearAuthToken();\n      isAuthenticated.set(false);\n    } finally {\n      isAuthLoading.set(false);\n    }\n  }\n\n  onMount(() => {\n    // Initialize auth\n    initializeAuth();\n  });\n</script>\n\n<style lang=\"postcss\">\n  :global(html) {\n    --primary: #2c3e50;\n    --secondary: #3498db;\n  }\n  @media print {\n    :global(body) {\n      height: auto !important;\n      overflow: visible !important;\n    }\n  }\n</style>\n\n{#if $isAuthLoading}\n  <div class=\"flex justify-center items-center h-screen\">\n    <div class=\"animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-gray-900 dark:border-white\"></div>\n  </div>\n{:else if $error}\n  <div class=\"flex flex-col items-center justify-center h-screen\">\n    <div class=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative\" role=\"alert\">\n      <strong class=\"font-bold\">Error!</strong>\n      <span class=\"block sm:inline\">{$error}</span>\n    </div>\n    <button \n      on:click={() => window.location.reload()} \n      class=\"mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\"\n    >\n      Try Again\n    </button>\n  </div>\n{:else}\n  {#if $isAuthenticated && $user && !isPublicRoute}\n    <!-- Authenticated layout -->\n    <div class=\"h-screen flex overflow-hidden bg-gray-100 print:h-auto print:overflow-visible\">\n      <!-- Mobile sidebar -->\n      {#if sidebarOpen}\n        <div class=\"md:hidden fixed inset-0 flex z-40 print:hidden\">\n          <button\n            class=\"fixed inset-0 bg-gray-600 bg-opacity-75\"\n            on:click={() => sidebarOpen = false}\n            on:keydown={(e) => e.key === 'Escape' && (sidebarOpen = false)}\n            aria-label=\"Close sidebar overlay\"\n          ></button>\n          <!-- Mobile SideNav -->\n          <SideNav isOpen={true} />\n        </div>\n      {/if}\n      <!-- Desktop sidebar -->\n      <div class=\"hidden md:flex md:flex-shrink-0 print:hidden\">\n        <SideNav isOpen={sidebarOpen} />\n      </div>\n      <!-- Main content -->\n      <div class=\"flex flex-col w-0 flex-1 overflow-hidden h-screen print:h-auto print:overflow-visible print:relative print:z-0\">\n        <div class=\"md:hidden pl-1 pt-1 sm:pl-3 sm:pt-3 print:hidden\">\n          <button\n            on:click={toggleSidebar}\n            class=\"-ml-0.5 -mt-0.5 h-12 w-12 inline-flex items-center justify-center rounded-md text-gray-500 hover:text-gray-900 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-secondary\"\n          >\n            <span class=\"sr-only\">Open sidebar</span>\n            <svg class=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M4 6h16M4 12h16M4 18h16\" />\n            </svg>\n          </button>\n        </div>\n        <main class=\"flex-1 relative z-0 overflow-y-auto focus:outline-none h-full print:h-auto print:overflow-visible print:relative print:z-0\">\n          <slot />\n        </main>\n      </div>\n    </div>\n  {:else}\n    <!-- Unauthenticated layout -->\n    <slot />\n  {/if}\n{/if} "],"names":["prerender","ssr","glimmerLogoUrl","isOpen","navItems","isActive","href","$page","path","$.each","ul","item","$.set_attribute","a","$.get","path_1","$.set_text","text","$.event","button","publicRoutes","sidebarOpen","toggleSidebar","$.set","initializeAuth","isAuthLoading","error","token","getAuthToken","pb","userData","_a","instructor","_b","user","isAuthenticated","learner","_c","clearAuthToken","err","onMount","isPublicRoute","route","$error","button_1","e","$$render","consequent_2","$isAuthenticated","$user","consequent_3","alternate_2","consequent_1","alternate_1","$isAuthLoading","consequent","alternate"],"mappings":"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"}