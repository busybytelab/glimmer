import{t as F,b as G,a as m}from"../chunks/Bm7YDail.js";import"../chunks/Cp0t8ydx.js";import{p as X,m as L,g as e,l as ae,a7 as D,e as te,c as u,s as v,d as Q,b as t,r as p,n as R,a as Z,t as V}from"../chunks/DwP7UOR7.js";import{e as ne,s as W}from"../chunks/DSFJq4oy.js";import{p as le,i as T}from"../chunks/DCRH5Z1i.js";import{i as ee}from"../chunks/C1itxWee.js";import{s as se,a as oe}from"../chunks/C3LHyfkz.js";import{c as ie,o as de}from"../chunks/CPg3bG_u.js";import{p as ce}from"../chunks/CHjSzMbL.js";import{g as K}from"../chunks/CxGvuVDF.js";import{p as U}from"../chunks/CGzTdwYZ.js";import{p as ve}from"../chunks/Bfc47y5P.js";import{F as ue,a as N}from"../chunks/C9_Sjxzs.js";import{F as M}from"../chunks/BEZkXVQy.js";import{E as pe}from"../chunks/CW8wjXXj.js";import{T as fe}from"../chunks/D1axDpGi.js";var ge=F('<div class="px-4 mb-6"><!></div>'),me=F('<form class="w-full"><!> <div class="px-4 py-4 bg-white w-full"><div class="grid grid-cols-6 gap-6"><!> <!> <!> <!> <!></div></div> <div class="px-4 py-3 bg-gray-50 border-t border-gray-200 flex justify-end space-x-4"><!> <!> <!></div></form>');function _e(O,j){X(j,!1);let l=le(j,"learner",8,null);const E=ie();let a=L(l()?{nickname:l().nickname,age:l().age,grade_level:l().grade_level||"",learning_preferences:Array.isArray(l().learning_preferences)?l().learning_preferences:[],avatar:l().avatar||""}:{nickname:"",age:0,grade_level:"",learning_preferences:[],avatar:""}),i=L(!1),o=L(null),f=L(e(a).learning_preferences.join(`
`));function Y(){return e(a).nickname.trim()?e(a).age<0||e(a).age>120?"Age must be between 0 and 120":null:"Nickname is required"}async function z(){const d=Y();if(d){t(o,d);return}try{if(t(i,!0),t(o,null),!U.authStore.model&&!l()){t(o,"You must be logged in to create a learner"),t(i,!1);return}const s={...e(a)};typeof s.learning_preferences=="string"&&(s.learning_preferences=s.learning_preferences.split(`
`).map(A=>A.trim()).filter(Boolean));let y;l()?y=await U.collection("learners").update(l().id,s):y=await U.collection("learners").create(s),E("update",y)}catch(h){console.error("Failed to save learner:",h),t(o,"Failed to save learner")}finally{t(i,!1)}}async function H(){if(l()&&confirm("Are you sure you want to delete this learner?"))try{t(i,!0),t(o,null),await U.collection("learners").delete(l().id),E("delete",l().id)}catch(d){console.error("Failed to delete learner:",d),t(o,"Failed to delete learner")}finally{t(i,!1)}}ae(()=>e(f),()=>{D(a,e(a).learning_preferences=e(f).split(`
`).map(d=>d.trim()).filter(Boolean))}),te(),ee();const q=Q(()=>l()?"Edit Learner":"Create Learner");ue(O,{get title(){return e(q)},description:"Enter the details for this learner",children:(d,h)=>{var s=me(),y=u(s);{var A=r=>{var _=ge(),w=u(_);pe(w,{get message(){return e(o)}}),p(_),m(r,_)};T(y,r=>{e(o)&&r(A)})}var P=v(y,2),B=u(P),I=u(B);N(I,{label:"Nickname",id:"nickname",type:"text",required:!0,cols:"col-span-6",placeholder:"Enter learner's nickname",get value(){return e(a).nickname},set value(r){D(a,e(a).nickname=r)},$$legacy:!0});var n=v(I,2);const c=Q(()=>e(a).age.toString());N(n,{label:"Age",id:"age",type:"number",get value(){return e(c)},required:!0,cols:"col-span-6 sm:col-span-3",placeholder:"Enter age",$$events:{input:r=>{const _=r.target;D(a,e(a).age=parseInt(_.value)||0)}}});var g=v(n,2);N(g,{label:"Grade Level",id:"gradeLevel",type:"text",cols:"col-span-6 sm:col-span-3",placeholder:"e.g. 3rd Grade",get value(){return e(a).grade_level},set value(r){D(a,e(a).grade_level=r)},$$legacy:!0});var C=v(g,2);fe(C,{id:"learning_preferences",label:"Learning Preferences",cols:"col-span-6",placeholder:"Enter learning preferences, one per line",get value(){return e(f)},set value(r){t(f,r)},$$legacy:!0});var $=v(C,2);N($,{label:"Avatar URL",id:"avatar",type:"text",cols:"col-span-6",placeholder:"Enter avatar image URL",get value(){return e(a).avatar},set value(r){D(a,e(a).avatar=r)},$$legacy:!0}),p(B),p(P);var b=v(P,2),k=u(b);M(k,{type:"button",variant:"secondary",$$events:{click:()=>E("cancel")},children:(r,_)=>{R();var w=G("Cancel");m(r,w)},$$slots:{default:!0}});var x=v(k,2);{var S=r=>{M(r,{type:"button",variant:"danger",get disabled(){return e(i)},$$events:{click:H},children:(_,w)=>{R();var re=G("Delete");m(_,re)},$$slots:{default:!0}})};T(x,r=>{l()&&r(S)})}var J=v(x,2);M(J,{type:"submit",get isLoading(){return e(i)},loadingText:"Saving...",children:(r,_)=>{R();var w=G("Save");m(r,w)},$$slots:{default:!0}}),p(b),p(s),ne("submit",s,ve(z)),m(d,s)},$$slots:{default:!0}}),Z()}var ye=F('<div class="flex justify-center items-center h-64"><div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div></div>'),$e=F('<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert"><strong class="font-bold">Error!</strong> <span class="block sm:inline"> </span></div>'),be=F('<div class="w-full"><!></div>'),xe=F('<div class="container mx-auto px-4 py-8 max-w-7xl"><div class="flex justify-between items-center mb-6"><h1 class="text-2xl font-bold text-gray-900"> </h1> <!></div> <!></div>');function Ce(O,j){X(j,!1);const[l,E]=se(),a=()=>oe(ce,"$page",l);let i=L(null),o=L(!0),f=L(null);de(async()=>{const n=a().params.id;if(!n){t(f,"No learner ID provided"),t(o,!1);return}await Y(n)});async function Y(n){try{t(o,!0),t(f,null);const c=await U.collection("learners").getOne(n,{expand:"user"}),g=c.expand;t(i,{...c,user:(g==null?void 0:g.user)||{name:"Unknown user"}})}catch(c){console.error("Failed to load learner:",c),t(f,"Failed to load learner")}finally{t(o,!1)}}function z(n){K("/learners")}function H(n){K("/learners")}function q(){K("/learners")}ee();var d=xe(),h=u(d),s=u(h),y=u(s,!0);p(s);var A=v(s,2);M(A,{type:"button",variant:"secondary",$$events:{click:q},children:(n,c)=>{R();var g=G("Back to Learners");m(n,g)},$$slots:{default:!0}}),p(h);var P=v(h,2);{var B=n=>{var c=ye();m(n,c)},I=(n,c)=>{{var g=$=>{var b=$e(),k=v(u(b),2),x=u(k,!0);p(k),p(b),V(()=>W(x,e(f))),m($,b)},C=($,b)=>{{var k=x=>{var S=be(),J=u(S);_e(J,{get learner(){return e(i)},$$events:{update:({detail:r})=>z(),delete:({detail:r})=>H(),cancel:q}}),p(S),m(x,S)};T($,x=>{e(i)&&x(k)},b)}};T(n,$=>{e(f)?$(g):$(C,!1)},c)}};T(P,n=>{e(o)?n(B):n(I,!1)})}p(d),V(()=>W(y,e(i)?"Edit Learner":"Loading...")),m(O,d),Z(),E()}export{Ce as component};
//# sourceMappingURL=7.xWukifW9.js.map
