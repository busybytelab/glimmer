import{t as _,a as v}from"../chunks/Bm7YDail.js";import"../chunks/Cp0t8ydx.js";import{p as Se,l as ke,e as Ae,a as Ee,g as e,m as f,c as n,d as Le,s as d,b as t,r as c,f as $e,t as b,n as Pe}from"../chunks/DwP7UOR7.js";import{s as x}from"../chunks/DSFJq4oy.js";import{i as g}from"../chunks/DCRH5Z1i.js";import{i as Te}from"../chunks/C1itxWee.js";import{s as je,a as Ce}from"../chunks/C3LHyfkz.js";import{o as Ie}from"../chunks/CPg3bG_u.js";import{p as Be}from"../chunks/CHjSzMbL.js";import{g as X}from"../chunks/CxGvuVDF.js";import{p as w}from"../chunks/CGzTdwYZ.js";import{L as ze}from"../chunks/E2d_wykc.js";import{B as Fe,A as qe}from"../chunks/CFNzRvmK.js";import{L as Z}from"../chunks/D1v2Wa_-.js";import{E as De}from"../chunks/CW8wjXXj.js";class Oe{async ensureAuth(){if(!w.authStore.isValid)throw new Error("You must be logged in to create a practice session")}async refreshAuth(){try{await w.collection("users").authRefresh()}catch{throw w.authStore.clear(),new Error("Your session has expired. Please log in again.")}}async makeRequest(h){const l=await fetch("/api/practice/session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:w.authStore.token},body:JSON.stringify(h)});if(!l.ok){const S=await l.json().catch(()=>({}));throw{status:l.status,message:S.message||`Server error: ${l.status}`}}return l.json()}async createSession(h){await this.ensureAuth();try{return await this.makeRequest(h)}catch(l){if(l.status===401){await this.refreshAuth();try{return await this.makeRequest(h)}catch(S){throw new Error(S.message)}}throw new Error(l.message)}}}const Re=new Oe;var Me=_('<div class="flex justify-center items-center h-64"><!></div>'),Ne=_('<p class="text-gray-600 mb-4"> </p>'),Je=_('<span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded"> </span>'),Ve=_('<span class="bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded"> </span>'),We=_('<span class="bg-orange-100 text-orange-800 text-xs font-medium px-2.5 py-0.5 rounded"> </span>'),Ye=_(`<div class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-50"><div class="bg-white rounded-lg p-8 max-w-md w-full mx-4"><div class="flex flex-col items-center"><!> <h3 class="text-xl font-semibold text-gray-900 mb-2">Creating Practice Session</h3> <p class="text-gray-600 text-center mb-4"> </p> <p class="text-gray-600 text-center mb-4">This may take a few minutes. Please don't refresh the page.</p> <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-primary h-2.5 rounded-full animate-pulse"></div></div></div></div></div>`),Ge=_('<div class="bg-white shadow-md rounded-lg p-6 mb-6"><h2 class="text-xl font-semibold text-gray-900 mb-2"> </h2> <!> <div class="flex flex-wrap gap-2 mb-4"><span class="bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded"> </span> <!> <!> <!></div></div> <h2 class="text-xl font-semibold text-gray-900 mb-4">Select a Learner</h2> <!> <!>',1),He=_('<div class="container mx-auto px-4 py-8"><div class="flex justify-between items-center mb-6"><div><!></div> <!></div> <!></div>');function pr(q,h){Se(h,!1);const[l,S]=je(),ee=()=>Ce(Be,"$page",l),D=f();let i=f(null),O=f([]),k=f(!0),L=f(!0),$=f(!1),P=f(null),u=f(null),E=null,R=f([]);Ie(async()=>{try{E=ee().params.id,E?(await re(E),await te(),se()):(t(u,"Invalid topic ID"),t(k,!1))}catch(a){console.error("Error in onMount:",a),t(u,a instanceof Error?a.message:"An unexpected error occurred"),t(k,!1)}});async function re(a){try{if(t(k,!0),t(u,null),!a)throw new Error("Topic ID is required");const r=await w.collection("practice_topics").getOne(a);if(r.tags){const m=r.tags;if(typeof m=="string")try{m.trim().startsWith("[")?r.tags=JSON.parse(m):r.tags=m.split(",").map(A=>A.trim()).filter(Boolean)}catch(A){console.error("Error parsing tags:",A),r.tags=[]}}else r.tags=[];t(i,r)}catch(r){console.error("Failed to load topic:",r),t(u,"Failed to load practice topic")}finally{t(k,!1)}}async function te(){try{t(L,!0);const a=await w.collection("learners").getList(1,50,{sort:"nickname",expand:"user"});t(O,a.items)}catch(a){console.error("Failed to load learners:",a),t(u,"Failed to load learners")}finally{t(L,!1)}}function ae(){X(`/practice-topics/${E}`)}async function M(a){if(e(i))try{t($,!0),t(u,null),t(P,a);const r=await Re.createSession({learnerId:a.id,practiceTopicId:e(i).id});X(`/practice-sessions/${r.id}`)}catch(r){console.error("Failed to create practice session:",r),t(u,r instanceof Error?r.message:"An unexpected error occurred")}finally{t($,!1),t(P,null)}}function se(){e(i)&&t(R,[{label:"Topics",href:"/practice-topics",icon:"topic"},{label:e(i).name,href:`/practice-topics/${e(i).id}`,icon:"topic"},{label:"Create Session",icon:"create"}])}ke(()=>{},()=>{t(D,{id:"back",label:"Back",icon:"back",variant:"secondary",onClick:ae})}),Ae(),Te();var T=He(),j=n(T),C=n(j),oe=n(C);Fe(oe,{get items(){return e(R)}}),c(C);var ie=d(C,2);const ne=Le(()=>[e(D)]);qe(ie,{get actions(){return e(ne)}}),c(j);var ce=d(j,2);{var le=a=>{var r=Me(),m=n(r);Z(m,{size:"md",color:"primary"}),c(r),v(a,r)},pe=(a,r)=>{{var m=y=>{De(y,{get message(){return e(u)}})},A=(y,de)=>{{var ue=I=>{var N=Ge(),B=$e(N),z=n(B),fe=n(z,!0);c(z);var J=d(z,2);{var me=s=>{var o=Ne(),p=n(o,!0);c(o),b(()=>x(p,e(i).description)),v(s,o)};g(J,s=>{e(i).description&&s(me)})}var V=d(J,2),F=n(V),ve=n(F,!0);c(F);var W=d(F,2);{var ge=s=>{var o=Je(),p=n(o);c(o),b(()=>x(p,`Age: ${e(i).target_age_range??""}`)),v(s,o)};g(W,s=>{e(i).target_age_range&&s(ge)})}var Y=d(W,2);{var _e=s=>{var o=Ve(),p=n(o);c(o),b(()=>x(p,`Grade: ${e(i).target_grade_level??""}`)),v(s,o)};g(Y,s=>{e(i).target_grade_level&&s(_e)})}var he=d(Y,2);{var xe=s=>{var o=We(),p=n(o);c(o),b(()=>x(p,`Difficulty: ${e(i).difficulty_level??""}`)),v(s,o)};g(he,s=>{e(i).difficulty_level&&s(xe)})}c(V),c(B);var G=d(B,4);ze(G,{get learners(){return e(O)},get loading(){return e(L)},emptyMessage:"No learners found. Please add learners to your account first.",onClick:M,cardActions:[{label:"Create Practice",color:"primary",onClick:M}]});var ye=d(G,2);{var be=s=>{var o=Ye(),p=n(o),H=n(p),K=n(H);Z(K,{size:"lg",color:"primary"});var Q=d(K,4),we=n(Q);c(Q),Pe(4),c(H),c(p),c(o),b(()=>{var U;return x(we,`We're generating personalized practice items for ${((U=e(P))==null?void 0:U.nickname)||"the learner"}.`)}),v(s,o)};g(ye,s=>{e($)&&s(be)})}b(()=>{x(fe,e(i).name),x(ve,e(i).subject)}),v(I,N)};g(y,I=>{e(i)&&I(ue)},de)}};g(a,y=>{e(u)?y(m):y(A,!1)},r)}};g(ce,a=>{e(k)?a(le):a(pe,!1)})}c(T),v(q,T),Ee(),S()}export{pr as component};
//# sourceMappingURL=12.-Sobw3R7.js.map
